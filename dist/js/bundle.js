"use strict";var _a,__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function l(e){try{i(o.next(e))}catch(e){r(e)}}function a(e){try{i(o.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}i((o=o.apply(e,t||[])).next())}))};const connection=new BareMux.BareMuxConnection("/baremux/worker.js"),wispUrl=("https:"===location.protocol?"wss":"ws")+"://"+location.host+"/wisp/",bareUrl=("https:"===location.protocol?"https":"http")+"://"+location.host+"/bare/";let searchHistory=[],currentHistoryIndex=-1;const urlPattern=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");null===(_a=document.getElementById("urlInput"))||void 0===_a||_a.addEventListener("keydown",(function(e){return __awaiter(this,void 0,void 0,(function*(){if("Enter"===e.key){e.preventDefault();let t=document.getElementById("urlInput").value,n="https://www.google.com/search?q=";urlPattern.test(t)?t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t):t=n+encodeURIComponent(t),(yield connection.getTransport())||(yield connection.setTransport("/epoxy/index.mjs",[{wisp:wispUrl}])),iframeWindow.src=__uv$config.prefix+__uv$config.encodeUrl(t),updateHistory(iframeWindow.src),updateArrows()}}))}));const updateHistory=e=>{searchHistory=[...searchHistory.slice(0,currentHistoryIndex+1),e],currentHistoryIndex++,localStorage.setItem("searchHistory",JSON.stringify(searchHistory)),updateArrows()},goBack=()=>{currentHistoryIndex>0&&(currentHistoryIndex--,iframeWindow.src=searchHistory[currentHistoryIndex],updateArrows())},goForward=()=>{currentHistoryIndex<searchHistory.length-1&&(currentHistoryIndex++,iframeWindow.src=searchHistory[currentHistoryIndex],updateArrows())},reloadPage=()=>{currentHistoryIndex>=0&&(iframeWindow.src=searchHistory[currentHistoryIndex])},updateArrows=()=>{const e=document.getElementById("backButton"),t=document.getElementById("forwardButton");e&&(currentHistoryIndex>0?(e.disabled=!1,e.style.opacity="1"):(e.disabled=!0,e.style.opacity="0.5")),t&&(currentHistoryIndex<searchHistory.length-1?(t.disabled=!1,t.style.opacity="1"):(t.disabled=!0,t.style.opacity="0.5"))};function handleTitleInput(){const e=sanitizeInput(document.getElementById("titleInput").value);"default"===e.toLowerCase()?(localStorage.setItem("titleCloak","Opal"),document.title="Opal"):(localStorage.setItem("titleCloak",e),document.title=e)}function handleFaviconInput(){const e=sanitizeInput(document.getElementById("faviconInput").value);"default"===e.toLowerCase()?(localStorage.setItem("faviconCloak",""),updateFavicon("")):(localStorage.setItem("faviconCloak",e),updateFavicon(e))}function handleClearCookiesInput(){"y"===sanitizeInput(document.getElementById("clearCookiesInput").value).toLowerCase()&&clearCookiesAndLocalStorage()}function clearCookiesAndLocalStorage(){const e=document.cookie.split(";");for(const t of e){const e=t.indexOf("="),n=e>-1?t.substr(0,e):t;document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}localStorage.clear(),location.reload()}function sanitizeInput(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function updateFavicon(e){let t=document.querySelector('link[rel="icon"]');t||(t=document.createElement("link"),t.setAttribute("rel","icon"),document.head.appendChild(t)),t.setAttribute("href",e||"about:blank")}function loadInitialValues(){const e=localStorage.getItem("titleCloak"),t=localStorage.getItem("faviconCloak"),n=localStorage.getItem("disableSplash");if(e){document.title=e;document.getElementById("titleInput").value=e}if(t){updateFavicon(t);document.getElementById("faviconInput").value=t}if(n){document.getElementById("disableSplashInput").value="true"===n?"y":"n"}}document.addEventListener("DOMContentLoaded",(()=>{const e=localStorage.getItem("searchHistory");e&&(searchHistory=JSON.parse(e),currentHistoryIndex=searchHistory.length-1);const t=document.getElementById("switcherButton"),n=document.getElementById("switcherButton2"),o=()=>{const e=localStorage.getItem("switcher")||"epoxyTransport";t.textContent=e,n.textContent=e},s=()=>{const e="epoxyTransport"===localStorage.getItem("switcher")?"bareMux":"epoxyTransport";switch(localStorage.setItem("switcher",e),o(),e){case"epoxyTransport":connection.setTransport("/epoxy/index.mjs",[{wisp:wispUrl}]);break;case"bareMux":connection.setTransport("/baremod/index.mjs",[bareUrl])}};o(),t.addEventListener("click",s),n.addEventListener("click",s);new MutationObserver(o).observe(document,{subtree:!0,childList:!0,attributes:!0}),window.addEventListener("storage",o);const r=()=>{const e=document.getElementById("websiteTitle");if(e)try{const t=iframeWindow.contentDocument||iframeWindow.contentWindow.document;e.textContent=t.title,t.title||(e.textContent="Opal")}catch(t){e.textContent="Opal"}};setInterval(r,1e3);const l=document.querySelector("iframe");if(l){new MutationObserver((()=>{r()})).observe(l,{attributes:!0,attributeFilter:["src"]})}updateArrows();const a=document.getElementById("urlInput");if(document.querySelectorAll("input").forEach((e=>{setInterval((()=>{e.placeholder="_"===e.placeholder?"":"_"}),250)})),a){a.style.width="100px";const e=()=>{const e=document.createElement("span");e.style.visibility="hidden",e.style.position="absolute",e.style.whiteSpace="pre",e.style.font=window.getComputedStyle(a).font,e.textContent=a.value||a.placeholder,document.body.appendChild(e);const t=e.offsetWidth+10;a.style.width=a.value.length>75?"775px":`${Math.max(250,t)}px`,document.body.removeChild(e)};a.addEventListener("input",e),a.addEventListener("change",e),e()}const i=document.getElementById("botClock"),c=()=>{if(i){const e=new Date,t={weekday:"long"},n={hour:"numeric",minute:"numeric",hour12:!0},o=e.toLocaleDateString("en-US",t),s=e.toLocaleTimeString("en-US",n);i.innerText=`${o}, ${s}`}};c(),setInterval(c,15e3);const d=document.querySelector(".search");a&&d&&(a.addEventListener("focus",(()=>{d.style.transform="translateX(11vw)"})),a.addEventListener("blur",(()=>{d.style.transform="translateX(17.5vw)"}))),localStorage.getItem("hasVisited")||setTimeout((()=>{const e=document.getElementById("urlInput");e&&e.focus()}),250);const u=new URLSearchParams(window.location.search);if(u.has("q")){const e=u.get("q");if(e&&a){a.value=e;const t=new KeyboardEvent("keydown",{key:"Enter"});a.dispatchEvent(t)}}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("settingsButton"),t=document.querySelector(".iframeWindow"),n=document.querySelector(".settingsWindow"),o=document.querySelectorAll(".settingsComponent"),s=document.getElementById("titleInput"),r=document.getElementById("faviconInput"),l=document.getElementById("clearCookiesInput");document.getElementById("disableSplashInput");e&&t&&n&&o.length>0&&(e.addEventListener("click",(()=>{t.classList.toggle("settingsOpen"),n.classList.toggle("settingsOpen"),e.classList.toggle("settingsOpen"),o.forEach((e=>{e.classList.toggle("settingsOpen")}))})),s&&s.addEventListener("keypress",(e=>{"Enter"===e.key&&handleTitleInput()})),r&&r.addEventListener("keypress",(e=>{"Enter"===e.key&&handleFaviconInput()})),l&&l.addEventListener("keypress",(e=>{"Enter"===e.key&&handleClearCookiesInput()})),loadInitialValues())})),document.addEventListener("DOMContentLoaded",(()=>{function e(){const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background='url("../assets/splashsmall.png") no-repeat center center',e.style.backgroundSize="cover",e.style.transition="transform 0.3s ease-in, opacity 0.4s ease-in",document.body.appendChild(e);const t=document.createElement("span");t.textContent="Opal",t.style.position="absolute",t.style.top="175px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.fontSize="128px",t.style.fontFamily="Open Sans",t.style.color="#FFF",t.style.textAlign="center",t.style.fontStyle="normal",t.style.fontWeight="600",t.style.lineHeight="normal",e.appendChild(t);const n=document.createElement("span");n.style.color="rgba(255, 255, 255, 0.70)",n.style.textAlign="center",n.style.textShadow="0px 0px 4px #FFF",n.style.fontFamily="Open Sans",n.style.fontSize="20px",n.style.fontStyle="normal",n.style.fontWeight="400",n.style.lineHeight="normal",n.style.position="absolute",n.style.left="50%",n.style.bottom="150px",n.style.transform="translateX(-50%)",e.appendChild(n);const o=()=>{if(n){const e=new Date,t={weekday:"long"},o={hour:"numeric",minute:"numeric",hour12:!0},s=e.toLocaleDateString("en-US",t),r=e.toLocaleTimeString("en-US",o);n.innerText=`${s}, ${r}`}};o(),setInterval(o,15e3);const s=()=>{e.style.transition="transform 0.5s ease-in, opacity 0.5s ease-in",e.style.transform="translateY(-100%)",e.style.opacity="0",setTimeout((()=>e.remove()),500),document.removeEventListener("wheel",r),document.removeEventListener("keydown",s),document.removeEventListener("click",s),localStorage.getItem("hasVisited")||(localStorage.setItem("hasVisited","true"),setTimeout((()=>{const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.style.zIndex="999",e.style.backdropFilter="blur(16px)",e.style.transition="background-color 0.3s ease";const t=document.createElement("div");t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.fontSize="24px",t.style.color="#333",t.style.padding="20px",t.style.backgroundColor="#313244",t.style.boxShadow="0px 2px 10px 0px rgba(0, 0, 0, 0.25)",t.style.borderRadius="9px",t.style.width="475px",t.style.height="300px",t.style.zIndex="1000",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.transition="background-color 0.3s ease";const n=document.createElement("button");n.style.position="absolute",n.style.top="10px",n.style.left="10px",n.style.width="16px",n.style.height="16px",n.style.background="#A6ADC8",n.style.border="none",n.style.borderRadius="100%",n.style.cursor="pointer",n.style.transition="background-color 0.3s ease";const o=document.createElement("div");o.style.boxShadow="0px 2px 10px 0px rgba(0, 0, 0, 0.25)",o.style.background='url("../assets/splashpfp2.png") no-repeat center center',o.style.backgroundSize="cover",o.style.width="128px",o.style.height="128px",o.style.flexShrink="0",o.style.borderRadius="100%",o.style.transform="translateY(0.3rem)",o.style.transition="background-color 0.3s ease";const s=document.createElement("div");s.style.color="#A6ADC8",s.style.textAlign="center",s.style.fontFamily="Open Sans",s.style.fontSize="26px",s.style.fontStyle="normal",s.style.fontWeight="400",s.style.lineHeight="normal",s.textContent="Welcome to Opal proxy, a fully featured and sleek Ultraviolet implementation",s.style.padding="1rem",s.style.transition="background-color 0.3s ease";const r=document.createElement("a");r.href="https://github.com/crllect",r.style.color="#CBA6F7",r.style.textAlign="center",r.style.fontFamily="Open Sans",r.style.fontSize="22px",r.style.fontStyle="normal",r.style.fontWeight="400",r.style.lineHeight="normal",r.style.textDecorationLine="underline",r.textContent="By crllect",r.style.transition="color 0.3s ease",t.addEventListener("mouseenter",(()=>n.style.background="#ED8796")),t.addEventListener("mouseleave",(()=>n.style.background="#A6ADC8")),t.appendChild(n),t.appendChild(o),t.appendChild(s),t.appendChild(r);const l=()=>{t.style.backgroundColor="rgba(0, 0, 0, 0)",e.style.backgroundColor="rgba(0, 0, 0, 0)",[n,o,s,r].forEach((e=>{e.style.opacity="0"}))};n.addEventListener("click",(()=>{l(),setTimeout((()=>{t.remove(),e.remove()}),300)})),e.addEventListener("click",(()=>{l(),setTimeout((()=>{t.remove(),e.remove()}),300)})),document.body.appendChild(e),document.body.appendChild(t)}),400))},r=e=>{e.preventDefault(),s()};setTimeout((()=>{document.addEventListener("wheel",r,{passive:!1}),document.addEventListener("keydown",s,{once:!0}),document.addEventListener("click",s,{once:!0})}),100)}const t=document.getElementById("splashButton");t&&t.addEventListener("click",e);const n=new URLSearchParams(window.location.search);localStorage.getItem("disableSplash")||n.has("q")||e()}));